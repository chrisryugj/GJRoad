<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì§„ì¶œë¡œ â€“ ì¶œì¥ê¸¸ ë„ìš°ë¯¸</title>
  <style>
    /* Modern CSS Reset & Base Styles */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      color: #333;
    }
    
    .app-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
    }
    
    /* Header Styles */
    .app-header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 30px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .app-title {
      font-size: 2rem;
      font-weight: 700;
      color: #1b3c82;
      margin-bottom: 5px;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    
    .app-title:hover {
      color: #4facfe;
    }
    
    .app-subtitle {
      color: #666;
      font-size: 1.1rem;
      margin-bottom: 15px;
    }
    
    /* Banner Styles */
    .app-banner {
      border-radius: 15px;
      padding: 0;
      margin: 15px 0 20px 0;
      overflow: hidden;
      position: relative;
      background: transparent;
    }
    
    .banner-image {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 15px;
    }
    
    /* Mode Selection Styles */
    .mode-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .mode-card {
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid transparent;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .mode-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }
    
    .mode-card.active {
      border-color: #1b3c82;
      background: #1b3c82;
      color: white;
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(27, 60, 130, 0.3);
    }
    
    .mode-icon {
      font-size: 2.5rem;
      margin-bottom: 10px;
      display: block;
    }
    
    .mode-title {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 5px;
    }
    
    .mode-desc {
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    /* Card Styles */
    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }
    
    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .card-icon {
      font-size: 1.5rem;
      color: #1b3c82;
    }
    
    .card-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: #333;
      margin: 0;
    }
    
    .card-content {
      line-height: 1.6;
    }
    
    /* Form Styles */
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }
    
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 15px;
      border: 2px solid #e1e5e9;
      border-radius: 12px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
    }
    
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: #1b3c82;
      box-shadow: 0 0 0 3px rgba(27, 60, 130, 0.1);
      background: white;
    }
    
    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    /* Button Styles */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 15px 25px;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      justify-content: center;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      border: 2px solid #e1e5e9;
    }
    
    .btn-secondary:hover {
      background: white;
      border-color: #1b3c82;
    }
    
    .btn-success {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      color: white;
    }
    
    .btn-full {
      width: 100%;
    }
    
    /* Map Selection Buttons */
    .map-option {
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid #e1e5e9;
      border-radius: 15px;
      padding: 20px 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      font-family: inherit;
    }
    
    .map-option:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      border-color: #1b3c82;
    }
    
    .map-option.selected {
      background: #1b3c82;
      color: white;
      border-color: #1b3c82;
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(27, 60, 130, 0.3);
    }
    
    .map-icon {
      width: 50px;
      height: 50px;
      margin: 0 auto 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      overflow: hidden;
    }
    
    .map-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .map-name {
      font-weight: 600;
      font-size: 0.95rem;
    }
    
    /* Step Indicator */
    .step-indicator {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      margin-bottom: 30px;
    }
    
    .step {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .step.completed {
      background: #4facfe;
      color: white;
    }
    
    .step.active {
      background: #1b3c82;
      color: white;
      transform: scale(1.1);
    }
    
    .step.pending {
      background: #f0f0f0;
      color: #999;
    }
    
    .step-line {
      width: 30px;
      height: 2px;
      background: #f0f0f0;
    }
    
    .step-line.completed {
      background: #4facfe;
    }
    
    /* Address Card Styles */
    .address-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 15px;
      border-left: 5px solid #e1e5e9;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .address-card:hover {
      transform: translateX(5px);
      border-left-color: #1b3c82;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    }
    
    .address-card.completed {
      border-left-color: #4facfe;
      background: rgba(79, 172, 254, 0.05);
    }
    
    .address-card.pending {
      border-left-color: #fa709a;
      background: rgba(250, 112, 154, 0.05);
    }
    
    .address-title {
      font-weight: 600;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .address-status {
      font-size: 0.9rem;
      padding: 5px 12px;
      border-radius: 20px;
      font-weight: 500;
    }
    
    .status-completed {
      background: rgba(79, 172, 254, 0.2);
      color: #1b3c82;
    }
    
    .status-pending {
      background: rgba(250, 112, 154, 0.2);
      color: #c62828;
    }
    
    .status-none {
      background: rgba(0, 0, 0, 0.1);
      color: #666;
    }
    
    /* Photo Grid */
    .photo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }
    
    .photo-preview {
      width: 100%;
      height: 80px;
      border-radius: 10px;
      object-fit: cover;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.8);
    }
    
    .photo-preview:hover {
      transform: scale(1.05);
      border-color: #1b3c82;
    }
    
    /* Data Management Styles */
    .data-management {
      text-align: center;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      backdrop-filter: blur(5px);
    }
    
    .data-status {
      font-size: 1rem;
      color: rgba(27, 60, 130, 0.8);
      font-weight: 500;
    }
    
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }
    
    .modal.show {
      display: flex;
    }
    
    .modal-content {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    .modal-header {
      text-align: center;
      margin-bottom: 25px;
    }
    
    .modal-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1b3c82;
      margin-bottom: 10px;
    }
    
    .modal-subtitle {
      color: #666;
      font-size: 0.95rem;
    }
    
    .option-grid {
      display: grid;
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .option-card {
      background: rgba(255, 255, 255, 0.8);
      border: 2px solid #e1e5e9;
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }
    
    .option-card:hover {
      border-color: #1b3c82;
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    }
    
    .option-card.danger:hover {
      border-color: #e74c3c;
      background: rgba(231, 76, 60, 0.05);
    }
    
    .option-card.warning:hover {
      border-color: #f39c12;
      background: rgba(243, 156, 18, 0.05);
    }
    
    .option-icon {
      font-size: 2rem;
      margin-bottom: 10px;
    }
    
    .option-title {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .option-desc {
      font-size: 0.9rem;
      color: #666;
    }
    
    /* Hide sections by default */
    .mode-section {
      display: none;
    }
    
    .mode-section.active {
      display: block;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .app-container {
        padding: 15px;
      }
      
      .mode-selector {
        grid-template-columns: 1fr 1fr 1fr 1fr;
        gap: 8px;
      }
      
      .mode-card {
        padding: 12px 8px;
        text-align: center;
      }
      
      .mode-icon {
        font-size: 1.8rem;
        margin-bottom: 5px;
      }
      
      .mode-title {
        font-size: 0.85rem;
        margin-bottom: 0;
      }
      
      .mode-desc {
        display: none;
      }
      
      .card {
        padding: 20px;
      }
      
      .app-title {
        font-size: 1.7rem;
      }
      
      .btn {
        padding: 12px 20px;
      }
      
      .map-button-selector {
        grid-template-columns: 1fr 1fr 1fr !important;
        gap: 10px !important;
      }
      
      .map-option {
        padding: 15px 10px !important;
      }
      
      .map-name {
        font-size: 0.85rem !important;
      }
    }
    
    @media (max-width: 480px) {
      .mode-selector {
        grid-template-columns: 1fr 1fr 1fr 1fr;
        gap: 6px;
      }
      
      .mode-card {
        padding: 10px 6px;
      }
      
      .mode-icon {
        font-size: 1.5rem;
        margin-bottom: 3px;
      }
      
      .mode-title {
        font-size: 0.75rem;
      }
      
      .step-indicator {
        gap: 10px;
      }
      
      .step {
        width: 35px;
        height: 35px;
      }
      
      .step-line {
        width: 20px;
      }
    }
    
    /* Legacy styles for compatibility */
    .dropdown-item.memo-marked::after {
      content: "\1F4DD";
      float: right;
      margin-left: 8px;
      font-size: 1rem;
    }
    
    #customDropdown {
      position: absolute;
      z-index: 1000;
      background-color: white;
      width: calc(100% - 22px);
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    header {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 10px;
    }
    header > div {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }
    header img {
      height: 36px;
      cursor: pointer;
    }
    header span {
      color: #1b3c82;
    }
    header .sub {
      color: #555;
    }
    #bannerImage {
      width: 100%;
      max-width: 100%;
      display: none;
      margin-top: 8px;
      border-radius: 8px;
    }
  .tabs {
  display: flex;
  justify-content: center;
  flex-wrap: nowrap;
  overflow-x: auto;
  gap: 8px;
  margin-bottom: 10px;
}
.tabs button {
  flex: 0 1 auto; /* ì¤„ì–´ë“¤ê±°ë‚˜ ëŠ˜ì–´ë‚˜ì§€ ì•Šë„ë¡ ì¡°ì • */
  white-space: nowrap;
  padding: 8px 16px;
}
    .tabs button.active {
      background-color: #1b3c82;
      color: #fff;
    }
    .tab-content {
      display: none;
      background: white;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .tab-content.active {
      display: block;
    }
    .card-ui {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      padding: 15px;
      margin-bottom: 15px;

    }
    input[type="text"], input[type="file"], select, button, textarea {
      width: 100%;
      margin-bottom: 8px;
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }
    #customStatusInput {
      background-color: #fff8dc;
      border-color: #f0c36d;
    }
    textarea {
      resize: vertical;
      height: 100px;
    }
    .dropdown-item {
      padding: 6px;
      font-size: 0.9rem;
      cursor: pointer;
    }
    .dropdown-item.viewed {
      background-color: #e0f7fa;
    }
    .status-marked {
      font-weight: bold;
    }
    canvas {
      width: 100%;
      max-width: 400px;
      height: auto;
      display: block;
      margin: 10px auto;
    }
    #chartTextOutput {
      margin-top: 10px;
      text-align: center;
      font-size: 0.9rem;
    }
tr.status-ì¶œì¥ì™„ë£Œ { background-color: #e8f5e9; }
tr.status-ë¯¸ì¶œì¥ { background-color: #ffebee; }
tr.status-ë¯¸ì„ íƒ { background-color: #eceff1; }

/* ê¸°íƒ€ ì§ì ‘ì…ë ¥ ìƒíƒœ (ì»¤ìŠ¤í…€) */
tr.status-ì§ì ‘ì…ë ¥ {
  background-color: #fff9c4; /* ì—°ë…¸ë‘ */
}
    footer {
      display: flex;
      justify-content: center;
      align-items: center;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 12px;
      margin-top: 30px;
      font-size: 0.8rem;
      color: #888;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- App Header -->
    <div class="app-header">
      <div class="app-title" onclick="goHome()">ì§„ì¶œë¡œ (é€²å‡ºè·¯)</div>
      <div class="app-subtitle">ì¶œì¥ê¸¸ ìŠ¤ë§ˆíŠ¸ ë„ìš°ë¯¸</div>
      
      <!-- Data Management Options -->
      <div id="data-management" class="data-management" style="margin: 20px 0;">
        <div class="data-status" id="data-status">
          <span>ğŸ—‚ï¸ <span id="total-addresses">0</span>ê°œ ì¶œì¥ì§€ ë“±ë¡ë¨</span>
        </div>
        <div class="data-actions" style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
          <button class="btn btn-secondary" onclick="showDataOptions()" id="manage-data-btn" style="padding: 8px 16px; font-size: 0.9rem;">
            âš™ï¸ ë°ì´í„° ê´€ë¦¬
          </button>
        </div>
      </div>
      
      <!-- Mode Selection -->
      <div class="mode-selector">
        <div class="mode-card active" data-mode="prepare" onclick="selectMode('prepare')">
          <span class="mode-icon">ğŸ“‹</span>
          <div class="mode-title">ì¤€ë¹„ëª¨ë“œ</div>
          <div class="mode-desc">ì¶œì¥ ì¤€ë¹„</div>
        </div>
        
        <div class="mode-card" data-mode="travel" onclick="selectMode('travel')">
          <span class="mode-icon">ğŸš—</span>
          <div class="mode-title">ì¶œì¥ëª¨ë“œ</div>
          <div class="mode-desc">í˜„ì¥ ì´ë™</div>
        </div>
        
        <div class="mode-card" data-mode="record" onclick="selectMode('record')">
          <span class="mode-icon">ğŸ“</span>
          <div class="mode-title">ê¸°ë¡ëª¨ë“œ</div>
          <div class="mode-desc">ë©”ëª¨ ì‘ì„±</div>
        </div>
        
        <div class="mode-card" data-mode="summary" onclick="selectMode('summary')">
          <span class="mode-icon">ğŸ“ˆ</span>
          <div class="mode-title">ì •ë¦¬ëª¨ë“œ</div>
          <div class="mode-desc">ë°ì´í„° ì •ë¦¬</div>
        </div>
      </div>
    </div>

    <!-- Prepare Mode -->
    <div id="mode-prepare" class="mode-section active">
      <!-- Step Indicator -->
      <div class="step-indicator">
        <div class="step active" data-step="1">1</div>
        <div class="step-line"></div>
        <div class="step pending" data-step="2">2</div>
        <div class="step-line"></div>
        <div class="step pending" data-step="3">3</div>
      </div>
      
      <!-- Step 1: Map Selection -->
      <div class="card" id="step-map">
        <div class="card-header">
          <span class="card-icon">ğŸ—ºï¸</span>
          <h3 class="card-title">1ë‹¨ê³„: ì§€ë„ ì•± ì„ íƒ</h3>
        </div>
        <div class="card-content">
          <div class="form-group">
            <label class="form-label">ì‚¬ìš©í•  ì§€ë„ ì•±ì„ ì„ íƒí•˜ì„¸ìš”</label>
            
            <!-- Map Selection Buttons -->
            <div class="map-selector map-button-selector" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 20px;">
              <button class="map-option" data-map="naver" onclick="selectMapApp('naver')">
                <div class="map-icon">
                  <img src="https://chrisryugj.github.io/GJRoad/images/nmap.jpg" alt="ë„¤ì´ë²„ì§€ë„">
                </div>
                <div class="map-name">ë„¤ì´ë²„ì§€ë„</div>
              </button>
              
              <button class="map-option" data-map="kakao" onclick="selectMapApp('kakao')">
                <div class="map-icon">
                  <img src="https://chrisryugj.github.io/GJRoad/images/kmap.jpg" alt="ì¹´ì¹´ì˜¤ë§µ">
                </div>
                <div class="map-name">ì¹´ì¹´ì˜¤ë§µ</div>
              </button>
              
              <button class="map-option" data-map="google" onclick="selectMapApp('google')">
                <div class="map-icon">
                  <img src="https://chrisryugj.github.io/GJRoad/images/gmap.jpg" alt="êµ¬ê¸€ì§€ë„">
                </div>
                <div class="map-name">êµ¬ê¸€ì§€ë„</div>
              </button>
            </div>
            
            <!-- Remember Choice Checkbox -->
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
              <input type="checkbox" id="rememberMap" checked style="width: auto; transform: scale(1.2);">
              <label for="rememberMap" style="margin: 0; font-size: 0.95rem; color: #666;">
                âœ… ì„ íƒí•œ ì§€ë„ ì•±ì„ ê¸°ì–µí•˜ê¸°
              </label>
            </div>
            
            <!-- Continue Button -->
            <button id="continueStep2" class="btn btn-primary btn-full" onclick="nextStep(2)" style="display: none;">
              â¡ï¸ 2ë‹¨ê³„ë¡œ ê³„ì†
            </button>
            
            <!-- Hidden select for compatibility -->
            <select id="mapSelect" style="display: none;">
              <option value="naver">ë„¤ì´ë²„ì§€ë„</option>
              <option value="kakao">ì¹´ì¹´ì˜¤ë§µ</option>
              <option value="google">êµ¬ê¸€ì§€ë„</option>
            </select>
          </div>
        </div>
      </div>
      
      <!-- Step 2: Address Input -->
      <div class="card" id="step-input" style="display: none;">
        <div class="card-header">
          <span class="card-icon">ğŸ </span>
          <h3 class="card-title">2ë‹¨ê³„: ì¶œì¥ì§€ ì…ë ¥</h3>
        </div>
        <div class="card-content">
          <!-- Default: Single Address Input -->
          <div class="form-group">
            <label class="form-label">ê°œë³„ ì…ë ¥</label>
            <input type="text" id="singleAddress" class="form-input" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <button class="btn btn-success btn-full" onclick="addSingleAddress()" style="margin-top: 10px;">
              â• ì¶œì¥ì§€ ì¶”ê°€
            </button>
          </div>
          <div id="added-addresses" class="form-group"></div>
          <button class="btn btn-primary btn-full" onclick="completeAddressInput()" style="display: none;" id="complete-btn">
            âœ“ ì…ë ¥ ì™„ë£Œ
          </button>
          
          <!-- Alternative Methods -->
          <div style="margin-top: 30px; border-top: 2px solid #f0f0f0; padding-top: 20px;">
            <div class="form-label" style="margin-bottom: 15px;">ë‹¤ë¥¸ ì…ë ¥ ë°©ë²•</div>
            <div style="display: grid; gap: 10px;">
              <button class="btn btn-secondary" onclick="toggleInputMethod('file')">
                ğŸ“ íŒŒì¼ ì—…ë¡œë“œ
              </button>
              <button class="btn btn-secondary" onclick="toggleInputMethod('bulk')">
                ğŸ“‹ ì¼ê´„ ë¶™ì—¬ë„£ê¸°
              </button>
            </div>
          </div>
          
          <!-- File Upload (Hidden by default) -->
          <div id="file-input-section" style="display: none; margin-top: 20px; padding: 20px; background: rgba(0,0,0,0.05); border-radius: 12px;">
            <div class="form-group">
              <label class="form-label">TXT ë˜ëŠ” CSV íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</label>
              <input type="file" id="fileUpload" class="form-input" accept=".txt,.csv" onchange="loadAddressFile(event)">
            </div>
          </div>
          
          <!-- Bulk Paste (Hidden by default) -->
          <div id="bulk-input-section" style="display: none; margin-top: 20px; padding: 20px; background: rgba(0,0,0,0.05); border-radius: 12px;">
            <div class="form-group">
              <label class="form-label">ì£¼ì†Œë¥¼ ì¤„ ë‹¨ìœ„ë¡œ ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”</label>
              <textarea id="bulkPaste" class="form-textarea" placeholder="ì˜ˆ:
ì„œìš¸ì‹œ ê´‘ì§„êµ¬ êµ¬ì˜ë™ 123
ì„œìš¸ì‹œ ê´‘ì§„êµ¬ ìì–‘ë™ 456
..."></textarea>
              <button class="btn btn-success btn-full" onclick="addFromTextarea()" style="margin-top: 10px;">
                ğŸ’¾ ì¶œì¥ì§€ ì €ì¥
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Step 3: Address List Preview -->
      <div class="card" id="step-preview" style="display: none;">
        <div class="card-header">
          <span class="card-icon">ğŸ“‹</span>
          <h3 class="card-title">3ë‹¨ê³„: ì¶œì¥ì§€ ëª©ë¡ í™•ì¸</h3>
        </div>
        <div class="card-content">
          <div id="address-preview-list"></div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
            <button class="btn btn-danger" onclick="resetAddressList()">
              ğŸ—‘ï¸ ëª©ë¡ ì´ˆê¸°í™”
            </button>
            <button class="btn btn-primary" onclick="selectMode('travel')">
              ğŸš— ì¶œì¥ ì‹œì‘
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Travel Mode -->
    <div id="mode-travel" class="mode-section">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">ğŸš—</span>
          <h3 class="card-title">ì¶œì¥ì§€ ëª©ë¡</h3>
        </div>
        <div class="card-content">
          <div id="travel-address-list"></div>
        </div>
      </div>
    </div>
    
    <!-- Record Mode -->
    <div id="mode-record" class="mode-section">
      <div class="card" id="record-card">
        <div class="card-header">
          <span class="card-icon">ğŸ“</span>
          <h3 class="card-title" id="record-title">ê¸°ë¡ ì‘ì„±</h3>
        </div>
        <div class="card-content">
          <div class="form-group">
            <label class="form-label">ì¶œì¥ ìƒíƒœ ì„ íƒ</label>
            <select id="recordStatusSelect" class="form-select" onchange="handleRecordStatusChange()">
              <option value="" disabled selected>ìƒíƒœ ì„ íƒ</option>
              <option value="ì¶œì¥ì™„ë£Œ">ì¶œì¥ì™„ë£Œ</option>
              <option value="ë¯¸ì¶œì¥">ë¯¸ì¶œì¥</option>
              <option value="ì§ì ‘ì…ë ¥">ì§ì ‘ì…ë ¥</option>
            </select>
            <input type="text" id="customRecordStatus" class="form-input" placeholder="ìƒíƒœ ì§ì ‘ ì…ë ¥" style="display: none; margin-top: 10px;">
          </div>
          
          <div class="form-group">
            <label class="form-label">í˜„ì¥ ë©”ëª¨</label>
            <textarea id="recordMemo" class="form-textarea" placeholder="í˜„ì¥ íŠ¹ì´ì‚¬í•­ì´ë‚˜ ì°¸ê³  ë©”ëª¨ë¥¼ ë‚¨ê¸°ì„¸ìš”"></textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">í˜„ì¥ ì‚¬ì§„ (ìµœëŒ€ 5ì¥)</label>
            <input type="file" id="recordPhotoInput" class="form-input" accept="image/*" multiple onchange="saveRecordPhoto()">
            <div id="recordPhotoContainer" class="photo-grid"></div>
          </div>
          
          <button class="btn btn-success btn-full" onclick="saveRecord()">
            ğŸ’¾ ê¸°ë¡ ì €ì¥
          </button>
        </div>
      </div>
    </div>
    
    <!-- Summary Mode -->
    <div id="mode-summary" class="mode-section">
      <div class="card">
        <div class="card-header">
          <span class="card-icon">ğŸ“ˆ</span>
          <h3 class="card-title">ì¶œì¥ í†µê³„</h3>
        </div>
        <div class="card-content">
          <div id="statsCount" style="text-align: center; font-weight: bold; margin-bottom: 20px; font-size: 1.2rem;"></div>
          <canvas id="statusChart" width="400" height="300"></canvas>
          <div id="chartTextOutput" style="text-align: center; margin-top: 15px; font-size: 0.95rem;"></div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <span class="card-icon">ğŸ“Š</span>
          <h3 class="card-title">ì „ì²´ ëª©ë¡</h3>
        </div>
        <div class="card-content">
          <div id="tableSummary" style="text-align: center; margin-bottom: 20px; font-weight: 600;"></div>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
            <button class="btn btn-secondary" onclick="copyTable()">
              ğŸ“„ ë³µì‚¬í•˜ê¸°
            </button>
            <button class="btn btn-secondary" onclick="exportText()">
              ğŸ“ í…ìŠ¤íŠ¸ ë‹¤ìš´ë¡œë“œ
            </button>
            <button class="btn btn-success" onclick="exportExcel()">
              ğŸ“… ì—‘ì…€ë¡œ ë‹¤ìš´ë¡œë“œ
            </button>
          </div>
          <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
              <thead>
                <tr style="background: rgba(27, 60, 130, 0.1); border-bottom: 2px solid #1b3c82;">
                  <th style="padding: 15px; text-align: left; font-weight: 600;">ì£¼ì†Œ</th>
                  <th style="padding: 15px; text-align: left; font-weight: 600;">ìƒíƒœ</th>
                  <th style="padding: 15px; text-align: left; font-weight: 600;">ë©”ëª¨</th>
                  <th style="padding: 15px; text-align: left; font-weight: 600;">ì‚¬ì§„</th>
                </tr>
              </thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Hidden elements for compatibility -->
  <div style="display: none;">
    <!-- Legacy elements for compatibility -->
    <input id="addrInput" name="no_autofill" type="text" style="display: none;">
    <div id="memoSection" style="display: none;">
      <textarea id="memoInput"></textarea>
      <input type="file" id="photoInput" accept="image/*" multiple>
      <div id="photoContainer" class="photo-grid"></div>
    </div>
    <div id="customDropdown" style="display: none;"></div>
    <select id="statusSelect" style="display: none;">
      <option value="">ì„ íƒ</option>
      <option value="ì¶œì¥ì™„ë£Œ">ì¶œì¥ì™„ë£Œ</option>
      <option value="ë¯¸ì¶œì¥">ë¯¸ì¶œì¥</option>
      <option value="ì§ì ‘ì…ë ¥">ì§ì ‘ì…ë ¥</option>
    </select>
    <input id="customStatusInput" type="text" style="display: none;">
</div>

  
  <!-- Data Management Modal -->
  <div id="dataModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">ğŸ“Š ë°ì´í„° ê´€ë¦¬</div>
        <div class="modal-subtitle">ì¶œì¥ ê¸°ë¡ì„ ê´€ë¦¬í•˜ê±°ë‚˜ ì´ˆê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
      </div>
      
      <div class="option-grid">
        <div class="option-card" onclick="continueWithExistingData()">
          <div class="option-icon">âœ…</div>
          <div class="option-title">ê¸°ì¡´ ë°ì´í„°ë¡œ ê³„ì†í•˜ê¸°</div>
          <div class="option-desc">ì €ì¥ëœ ì¶œì¥ì§€ì™€ ê¸°ë¡ì„ ìœ ì§€í•©ë‹ˆë‹¤</div>
        </div>
        
        <div class="option-card warning" onclick="showResetOptions()">
          <div class="option-icon">ğŸ”„</div>
          <div class="option-title">ë°ì´í„° ì´ˆê¸°í™”</div>
          <div class="option-desc">ì¼ë¶€ ë˜ëŠ” ì „ì²´ ë°ì´í„°ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤</div>
        </div>
      </div>
      
      <div style="text-align: center;">
        <button class="btn btn-secondary" onclick="closeModal()">
          ì·¨ì†Œ
        </button>
      </div>
    </div>
  </div>
  
  <!-- Reset Options Modal -->
  <div id="resetModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">ğŸ”„ ë°ì´í„° ì´ˆê¸°í™” ì˜µì…˜</div>
        <div class="modal-subtitle">ì´ˆê¸°í™”í•  ë°ì´í„° ë²”ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
      </div>
      
      <div class="option-grid">
        <div class="option-card" onclick="showAddressSelector()">
          <div class="option-icon">ğŸ¯</div>
          <div class="option-title">ì„ íƒ ì´ˆê¸°í™”</div>
          <div class="option-desc">íŠ¹ì • ì¶œì¥ì§€ì˜ ê¸°ë¡ë§Œ ì‚­ì œí•©ë‹ˆë‹¤</div>
        </div>
        
        <div class="option-card danger" onclick="confirmFullReset()">
          <div class="option-icon">ğŸ’¥</div>
          <div class="option-title">ì „ì²´ ì´ˆê¸°í™”</div>
          <div class="option-desc">ëª¨ë“  ì¶œì¥ì§€ì™€ ê¸°ë¡ì„ ì™„ì „íˆ ì‚­ì œí•©ë‹ˆë‹¤</div>
        </div>
      </div>
      
      <div style="display: flex; gap: 10px; justify-content: center;">
        <button class="btn btn-secondary" onclick="showResetOptions()">
          â† ë’¤ë¡œ
        </button>
        <button class="btn btn-secondary" onclick="closeModal()">
          ì·¨ì†Œ
        </button>
      </div>
    </div>
  </div>
  
  <!-- Address Selector Modal -->
  <div id="addressSelectorModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">ğŸ¯ ì¶œì¥ì§€ ì„ íƒ</div>
        <div class="modal-subtitle">ì´ˆê¸°í™”í•  ì¶œì¥ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
      </div>
      
      <div id="address-selector-list" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;">
        <!-- Address list will be populated here -->
      </div>
      
      <div style="display: flex; gap: 10px; justify-content: center;">
        <button class="btn btn-danger" onclick="resetSelectedAddresses()" id="reset-selected-btn" style="display: none;">
          ğŸ—‘ï¸ ì„ íƒëœ í•­ëª© ì‚­ì œ
        </button>
        <button class="btn btn-secondary" onclick="showResetOptions()">
          â† ë’¤ë¡œ
        </button>
        <button class="btn btn-secondary" onclick="closeModal()">
          ì·¨ì†Œ
        </button>
      </div>
    </div>
  </div>
  
  <footer style="text-align: center; padding: 20px; color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
    Â© 2025 ê´‘ì§„êµ¬ì²­ ê°€ë¡œê²½ê´€ê³¼ Â· ì§„ì¶œë¡œ v2.0
  </footer>
  
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
// App State Management
const AppState = {
  currentMode: 'prepare',
  currentStep: 1,
  currentAddress: null,
  inputMethod: null
};

// Data Storage
const originalPhotoMap = {};
let preferredMap = localStorage.getItem("preferredMap") || "naver";
let statusMap = JSON.parse(localStorage.getItem("statusMap")) || {};
let memoMap = JSON.parse(localStorage.getItem("memoMap")) || {};
let photoMap = JSON.parse(localStorage.getItem("photoMap")) || {};
let ì£¼ì†Œëª©ë¡ = JSON.parse(localStorage.getItem("addressList")) || [];
let viewedAddresses = new Set(JSON.parse(localStorage.getItem("viewedAddresses")) || []);

// Mode Management Functions
function selectMode(mode) {
  // Update UI
  document.querySelectorAll('.mode-card').forEach(card => {
    card.classList.remove('active');
  });
  document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
  
  // Show/Hide sections
  document.querySelectorAll('.mode-section').forEach(section => {
    section.classList.remove('active');
  });
  document.getElementById(`mode-${mode}`).classList.add('active');
  
  AppState.currentMode = mode;
  
  // Initialize mode-specific content
  if (mode === 'travel') {
    updateTravelMode();
  } else if (mode === 'summary') {
    updateSummaryMode();
  } else if (mode === 'prepare') {
    // Show selected map app if exists
    updateMapSelection();
  }
}

function goHome() {
  // Reset to initial prepare mode state
  AppState.currentStep = 1;
  AppState.currentAddress = null;
  
  selectMode('prepare');
  
  // Reset step indicator
  updateStepIndicator();
  
  // Show step 1, hide others
  document.getElementById('step-map').style.display = 'block';
  document.getElementById('step-input').style.display = 'none';
  document.getElementById('step-preview').style.display = 'none';
  
  // Hide input sections
  document.getElementById('file-input-section').style.display = 'none';
  document.getElementById('bulk-input-section').style.display = 'none';
}

// Map Selection Functions
function selectMapApp(mapType) {
  preferredMap = mapType;
  
  // Update UI
  document.querySelectorAll('.map-option').forEach(btn => {
    btn.classList.remove('selected');
  });
  document.querySelector(`[data-map="${mapType}"]`).classList.add('selected');
  
  // Update hidden select for compatibility
  document.getElementById('mapSelect').value = mapType;
  
  // Show continue button
  document.getElementById('continueStep2').style.display = 'block';
  
  // Save preference if checkbox is checked
  if (document.getElementById('rememberMap').checked) {
    localStorage.setItem('preferredMap', preferredMap);
  }
}

function updateMapSelection() {
  // Restore selected map
  if (preferredMap) {
    document.querySelectorAll('.map-option').forEach(btn => {
      btn.classList.remove('selected');
    });
    const selectedBtn = document.querySelector(`[data-map="${preferredMap}"]`);
    if (selectedBtn) {
      selectedBtn.classList.add('selected');
      document.getElementById('continueStep2').style.display = 'block';
    }
  }
}

// Step Management for Prepare Mode
function nextStep(step) {
  AppState.currentStep = step;
  updateStepIndicator();
  
  if (step === 2) {
    document.getElementById('step-map').style.display = 'none';
    document.getElementById('step-input').style.display = 'block';
  } else if (step === 3) {
    document.getElementById('step-input').style.display = 'none';
    document.getElementById('address-input-forms').style.display = 'none';
    document.getElementById('step-preview').style.display = 'block';
    updateAddressPreview();
  }
}

function updateStepIndicator() {
  document.querySelectorAll('.step').forEach((step, index) => {
    const stepNum = index + 1;
    if (stepNum < AppState.currentStep) {
      step.className = 'step completed';
    } else if (stepNum === AppState.currentStep) {
      step.className = 'step active';
    } else {
      step.className = 'step pending';
    }
  });
  
  document.querySelectorAll('.step-line').forEach((line, index) => {
    if (index + 1 < AppState.currentStep) {
      line.classList.add('completed');
    } else {
      line.classList.remove('completed');
    }
  });
}

// Address Input Methods
function toggleInputMethod(method) {
  const fileSection = document.getElementById('file-input-section');
  const bulkSection = document.getElementById('bulk-input-section');
  
  // Hide all sections first
  fileSection.style.display = 'none';
  bulkSection.style.display = 'none';
  
  // Show selected section
  if (method === 'file') {
    fileSection.style.display = 'block';
  } else if (method === 'bulk') {
    bulkSection.style.display = 'block';
  }
}

function addSingleAddress() {
  const input = document.getElementById('singleAddress');
  const address = input.value.trim();
  
  if (!address) {
    alert('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  if (ì£¼ì†Œëª©ë¡.includes(address)) {
    alert('ì´ë¯¸ ì¶”ê°€ëœ ì£¼ì†Œì…ë‹ˆë‹¤.');
    return;
  }
  
  ì£¼ì†Œëª©ë¡.push(address);
  saveAddressList();
  updateDataStatus();
  
  // Update UI
  updateAddedAddresses();
  input.value = '';
  
  // Show complete button
  document.getElementById('complete-btn').style.display = 'block';
}

function updateAddedAddresses() {
  const container = document.getElementById('added-addresses');
  if (!container) return;
  
  container.innerHTML = ì£¼ì†Œëª©ë¡.map((addr, index) => `
    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(79, 172, 254, 0.1); border-radius: 8px; margin-bottom: 5px;">
      <span>${addr}</span>
      <button onclick="removeAddress(${index})" style="background: #fa709a; color: white; border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer;">ì‚­ì œ</button>
    </div>
  `).join('');
}

function removeAddress(index) {
  ì£¼ì†Œëª©ë¡.splice(index, 1);
  saveAddressList();
  updateDataStatus();
  updateAddedAddresses();
  
  if (ì£¼ì†Œëª©ë¡.length === 0) {
    document.getElementById('complete-btn').style.display = 'none';
  }
}

function completeAddressInput() {
  if (ì£¼ì†Œëª©ë¡.length === 0) {
    alert('ìµœì†Œ í•˜ë‚˜ì˜ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  nextStep(3);
}

function updateAddressPreview() {
  const container = document.getElementById('address-preview-list');
  if (!container) return;
  
  if (ì£¼ì†Œëª©ë¡.length === 0) {
    container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ë“±ë¡ëœ ì¶œì¥ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
    return;
  }
  
  container.innerHTML = ì£¼ì†Œëª©ë¡.map(addr => {
    const status = statusMap[addr] || 'ë¯¸ì„ íƒ';
    const statusClass = status === 'ì¶œì¥ì™„ë£Œ' ? 'completed' : status === 'ë¯¸ì¶œì¥' ? 'pending' : 'none';
    
    return `
      <div class="address-card ${status === 'ì¶œì¥ì™„ë£Œ' ? 'completed' : status === 'ë¯¸ì¶œì¥' ? 'pending' : ''}">
        <div class="address-title">
          <span>${addr}</span>
          <span class="address-status status-${statusClass}">${status}</span>
        </div>
      </div>
    `;
  }).join('');
}

// Travel Mode Functions
function updateTravelMode() {
  const container = document.getElementById('travel-address-list');
  if (!container) return;
  
  if (ì£¼ì†Œëª©ë¡.length === 0) {
    container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">ë¨¼ì € ì¤€ë¹„ëª¨ë“œì—ì„œ ì¶œì¥ì§€ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.</p>';
    return;
  }
  
  container.innerHTML = ì£¼ì†Œëª©ë¡.map(addr => {
    const status = statusMap[addr] || 'ë¯¸ì„ íƒ';
    const statusClass = status === 'ì¶œì¥ì™„ë£Œ' ? 'completed' : status === 'ë¯¸ì¶œì¥' ? 'pending' : 'none';
    
    return `
      <div class="address-card ${status === 'ì¶œì¥ì™„ë£Œ' ? 'completed' : status === 'ë¯¸ì¶œì¥' ? 'pending' : ''}" onclick="openAddressActions('${addr}')">
        <div class="address-title">
          <span style="font-size: 1.1rem;">${addr}</span>
          <span class="address-status status-${statusClass}">${status}</span>
        </div>
        <div style="margin-top: 10px; display: flex; gap: 10px;">
          <button class="btn btn-primary" onclick="event.stopPropagation(); openMapForAddress('${addr}')" style="flex: 1; padding: 10px;">
            ğŸ—ºï¸ ì§€ë„ ì—´ê¸°
          </button>
          <button class="btn btn-secondary" onclick="event.stopPropagation(); openRecordMode('${addr}')" style="flex: 1; padding: 10px;">
            ğŸ“ ê¸°ë¡í•˜ê¸°
          </button>
        </div>
      </div>
    `;
  }).join('');
}

function openMapForAddress(address) {
  const baseAddr = address.replace(/\s*\([^)]*\)\s*$/, '').trim();
  const encodedAddr = encodeURIComponent(baseAddr);
  
  let appUrl = '';
  let webUrl = '';
  
  if (preferredMap === 'naver') {
    appUrl = `nmap://search?query=${encodedAddr}`;
    webUrl = `https://map.naver.com/v5/search/${encodedAddr}`;
  } else if (preferredMap === 'kakao') {
    appUrl = `kakaomap://search?q=${encodedAddr}`;
    webUrl = `https://map.kakao.com/?q=${encodedAddr}`;
  } else if (preferredMap === 'google') {
    appUrl = `comgooglemaps://?q=${encodedAddr}`;
    webUrl = `https://www.google.com/maps/search/?api=1&query=${encodedAddr}`;
  }
  
  // Try to open mobile app first, fallback to web
  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  
  if (isMobile && appUrl) {
    // Create invisible iframe to test app availability
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    iframe.src = appUrl;
    document.body.appendChild(iframe);
    
    // Fallback to web after short delay
    setTimeout(() => {
      document.body.removeChild(iframe);
      window.open(webUrl, '_blank');
    }, 1000);
  } else {
    window.open(webUrl, '_blank');
  }
  
  // Mark as viewed
  viewedAddresses.add(address);
  saveViewedAddresses();
}

function openRecordMode(address) {
  AppState.currentAddress = address;
  selectMode('record');
  
  // Pre-fill record form
  document.getElementById('record-title').textContent = `${address} - ê¸°ë¡ ì‘ì„±`;
  document.getElementById('recordStatusSelect').value = statusMap[address] || '';
  document.getElementById('recordMemo').value = memoMap[address] || '';
  
  // Handle custom status
  const status = statusMap[address] || '';
  if (!['ì¶œì¥ì™„ë£Œ', 'ë¯¸ì¶œì¥', ''].includes(status)) {
    document.getElementById('recordStatusSelect').value = 'ì§ì ‘ì…ë ¥';
    document.getElementById('customRecordStatus').style.display = 'block';
    document.getElementById('customRecordStatus').value = status;
  }
  
  renderRecordPhotos();
}

// Record Mode Functions
function handleRecordStatusChange() {
  const select = document.getElementById('recordStatusSelect');
  const customInput = document.getElementById('customRecordStatus');
  
  if (select.value === 'ì§ì ‘ì…ë ¥') {
    customInput.style.display = 'block';
  } else {
    customInput.style.display = 'none';
  }
}

function saveRecord() {
  if (!AppState.currentAddress) return;
  
  const statusSelect = document.getElementById('recordStatusSelect');
  const customStatus = document.getElementById('customRecordStatus');
  const memo = document.getElementById('recordMemo').value.trim();
  
  let status = statusSelect.value;
  if (status === 'ì§ì ‘ì…ë ¥') {
    status = customStatus.value.trim().substring(0, 100);
  }
  
  // Save status
  if (status) {
    statusMap[AppState.currentAddress] = status;
  } else {
    delete statusMap[AppState.currentAddress];
  }
  
  // Save memo with timestamp
  if (memo) {
    const now = new Date();
    const datePrefix = now.toISOString().slice(0, 10);
    const timePrefix = now.toTimeString().slice(0, 5);
    memoMap[AppState.currentAddress] = `${datePrefix} ${timePrefix} - ${memo}`;
  } else {
    delete memoMap[AppState.currentAddress];
  }
  
  // Save to localStorage
  localStorage.setItem('statusMap', JSON.stringify(statusMap));
  localStorage.setItem('memoMap', JSON.stringify(memoMap));
  localStorage.setItem('photoMap', JSON.stringify(photoMap));
  
  alert('ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
  
  // Return to travel mode
  selectMode('travel');
}

// Photo handling for record mode
function saveRecordPhoto() {
  const input = document.getElementById('recordPhotoInput');
  const files = input.files;
  if (!files || !AppState.currentAddress) return;
  
  if (!Array.isArray(photoMap[AppState.currentAddress])) {
    photoMap[AppState.currentAddress] = [];
  }
  if (!Array.isArray(originalPhotoMap[AppState.currentAddress])) {
    originalPhotoMap[AppState.currentAddress] = [];
  }
  
  const urls = photoMap[AppState.currentAddress];
  if (urls.length >= 5) {
    alert('ì‚¬ì§„ì€ ìµœëŒ€ 5ì¥ê¹Œì§€ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
    return;
  }
  
  Array.from(files).forEach(file => {
    if (!file.type.startsWith('image/')) return;
    const reader = new FileReader();
    reader.onload = async e => {
      const img = new Image();
      img.onload = async () => {
        const canvas = document.createElement('canvas');
        const maxW = 800;
        const scale = maxW / img.width;
        canvas.width = maxW;
        canvas.height = img.height * scale;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        const resized = canvas.toDataURL('image/jpeg', 0.8);
        
        try {
          const uploaded = await uploadToImgur(resized);
          if (uploaded) {
            photoMap[AppState.currentAddress].push(uploaded);
            originalPhotoMap[AppState.currentAddress].push(uploaded);
            localStorage.setItem('photoMap', JSON.stringify(photoMap));
            renderRecordPhotos();
          }
        } catch (error) {
          alert('ì‚¬ì§„ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  });
  
  setTimeout(() => {
    input.value = '';
  }, 500);
}

function renderRecordPhotos() {
  const container = document.getElementById('recordPhotoContainer');
  if (!container || !AppState.currentAddress) return;
  
  container.innerHTML = '';
  const photos = Array.isArray(photoMap[AppState.currentAddress]) ? photoMap[AppState.currentAddress] : [];
  
  photos.forEach((url, i) => {
    const img = document.createElement('img');
    img.src = url;
    img.className = 'photo-preview';
    img.onclick = () => handleRecordPhotoClick(i);
    container.appendChild(img);
  });
}

function handleRecordPhotoClick(index) {
  const imgUrl = originalPhotoMap[AppState.currentAddress]?.[index];
  if (!imgUrl) return;
  
  const dialog = document.createElement('div');
  dialog.style.cssText = `
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: white; padding: 20px; border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 9999;
  `;
  dialog.innerHTML = `
    <p style="margin-bottom: 15px; text-align: center; font-weight: 600;">ì‚¬ì§„ ì˜µì…˜ì„ ì„ íƒí•˜ì„¸ìš”</p>
    <div style="display: flex; gap: 10px; justify-content: center;">
      <button id="viewBtn" class="btn btn-primary">ğŸ“· í¬ê²Œ ë³´ê¸°</button>
      <button id="deleteBtn" class="btn btn-danger">âŒ ì‚­ì œ</button>
      <button id="cancelBtn" class="btn btn-secondary">ì·¨ì†Œ</button>
    </div>
  `;
  document.body.appendChild(dialog);
  
  document.getElementById('viewBtn').onclick = () => {
    const popup = window.open('', '_blank');
    popup.document.write(`<img src='${imgUrl}' style='max-width:100%; height:auto;'>`);
    document.body.removeChild(dialog);
  };
  document.getElementById('deleteBtn').onclick = () => {
    deleteRecordPhoto(index);
    document.body.removeChild(dialog);
  };
  document.getElementById('cancelBtn').onclick = () => {
    document.body.removeChild(dialog);
  };
}

function deleteRecordPhoto(index) {
  if (!AppState.currentAddress || !photoMap[AppState.currentAddress]) return;
  photoMap[AppState.currentAddress].splice(index, 1);
  localStorage.setItem('photoMap', JSON.stringify(photoMap));
  renderRecordPhotos();
}
  
// Summary Mode Functions
function updateSummaryMode() {
  updateTable();
  drawChart();
}

function updateTable() {
  const tbody = document.getElementById('tableBody');
  if (!tbody) return;
  
  tbody.innerHTML = '';
  ì£¼ì†Œëª©ë¡.forEach(addr => {
    const rawStatus = statusMap[addr] || 'ë¯¸ì„ íƒ';
    const classStatus = ['ì¶œì¥ì™„ë£Œ', 'ë¯¸ì¶œì¥', 'ë¯¸ì„ íƒ'].includes(rawStatus) ? rawStatus : 'ì§ì ‘ì…ë ¥';
    const memo = memoMap[addr] || '-';
    const photos = Array.isArray(photoMap[addr]) ? photoMap[addr] : [];
    const photoCount = photos.length > 0 ? `ğŸ“· ${photos.length}ì¥` : '-';
    
    const row = document.createElement('tr');
    row.style.cssText = getStatusRowStyle(classStatus);
    row.innerHTML = `
      <td style="padding: 15px; border-bottom: 1px solid #e1e5e9;">${addr}</td>
      <td style="padding: 15px; border-bottom: 1px solid #e1e5e9;">${rawStatus}</td>
      <td style="padding: 15px; border-bottom: 1px solid #e1e5e9; max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="${memo}">${memo}</td>
      <td style="padding: 15px; border-bottom: 1px solid #e1e5e9;">${photoCount}</td>
    `;
    tbody.appendChild(row);
  });
  
  // Update summary
  const summary = document.getElementById('tableSummary');
  if (summary) {
    summary.textContent = `ì´ ${ì£¼ì†Œëª©ë¡.length}ê±´`;
  }
}

function getStatusRowStyle(status) {
  switch(status) {
    case 'ì¶œì¥ì™„ë£Œ': return 'background-color: rgba(76, 175, 80, 0.1);';
    case 'ë¯¸ì¶œì¥': return 'background-color: rgba(244, 67, 54, 0.1);';
    case 'ë¯¸ì„ íƒ': return 'background-color: rgba(158, 158, 158, 0.1);';
    default: return 'background-color: rgba(255, 193, 7, 0.1);';
  }
}

function drawChart() {
  const ctx = document.getElementById('statusChart');
  if (!ctx) return;
  
  const count = { ì¶œì¥ì™„ë£Œ: 0, ë¯¸ì¶œì¥: 0, ë¯¸ì„ íƒ: 0, ì§ì ‘ì…ë ¥: 0 };
  ì£¼ì†Œëª©ë¡.forEach(addr => {
    const status = statusMap[addr] || 'ë¯¸ì„ íƒ';
    const key = ['ì¶œì¥ì™„ë£Œ', 'ë¯¸ì¶œì¥', 'ë¯¸ì„ íƒ'].includes(status) ? status : 'ì§ì ‘ì…ë ¥';
    count[key]++;
  });
  
  const data = {
    labels: Object.keys(count),
    datasets: [{
      label: 'ìƒíƒœë³„ ê°œìˆ˜',
      data: Object.values(count),
      backgroundColor: ['#4caf50', '#f44336', '#90a4ae', '#ffcc80'],
      borderRadius: 8,
      borderWidth: 0
    }]
  };
  
  if (window.myChart) window.myChart.destroy();
  window.myChart = new Chart(ctx.getContext('2d'), {
    type: 'bar',
    data: data,
    options: { 
      responsive: true, 
      plugins: { 
        legend: { display: false },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          titleColor: 'white',
          bodyColor: 'white',
          borderColor: 'rgba(255, 255, 255, 0.2)',
          borderWidth: 1,
          cornerRadius: 8
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: {
            color: 'rgba(0, 0, 0, 0.1)'
          }
        },
        x: {
          grid: {
            display: false
          }
        }
      }
    }
  });
  
  const total = Object.values(count).reduce((a, b) => a + b, 0);
  const statsCount = document.getElementById('statsCount');
  const chartText = document.getElementById('chartTextOutput');
  
  if (statsCount) {
    statsCount.textContent = `ì´ í•­ëª© ìˆ˜: ${total}ê±´`;
  }
  if (chartText) {
    chartText.textContent = Object.entries(count).map(([k,v]) => `${k}: ${v}ê±´`).join(' / ');
  }
}

function copyTable() {
  let text = 'ì£¼ì†Œ\tìƒíƒœ\të©”ëª¨\tì‚¬ì§„ê°œìˆ˜\n';
  ì£¼ì†Œëª©ë¡.forEach(addr => {
    const status = statusMap[addr] || 'ë¯¸ì„ íƒ';
    const memo = (memoMap[addr] || '').replace(/\n/g, ' ');
    const photoCount = Array.isArray(photoMap[addr]) ? photoMap[addr].length : 0;
    text += addr + '\t' + status + '\t' + memo + '\t' + photoCount + '\n';
  });
  navigator.clipboard.writeText(text).then(() => alert('ë³µì‚¬ ì™„ë£Œ'));
}

function exportText() {
  let content = 'ì¶œì¥ ê¸°ë¡ - í…ìŠ¤íŠ¸ ë²„ì „\n';
  content += '='.repeat(50) + '\n\n';
  
  ì£¼ì†Œëª©ë¡.forEach((addr, index) => {
    const status = statusMap[addr] || 'ë¯¸ì„ íƒ';
    const memo = memoMap[addr] || 'ê¸°ë¡ ì—†ìŒ';
    const photoCount = Array.isArray(photoMap[addr]) ? photoMap[addr].length : 0;
    
    content += `${index + 1}. ${addr}\n`;
    content += `   ìƒíƒœ: ${status}\n`;
    content += `   ë©”ëª¨: ${memo}\n`;
    content += `   ì‚¬ì§„: ${photoCount}ì¥\n`;
    content += '-'.repeat(30) + '\n';
  });
  
  const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'ì¶œì¥ê¸°ë¡.txt';
  link.click();
}

function exportExcel() {
  const wb = XLSX.utils.book_new();
  const data = [['ì£¼ì†Œ', 'ìƒíƒœ', 'ë©”ëª¨', 'ì‚¬ì§„1', 'ì‚¬ì§„2', 'ì‚¬ì§„3', 'ì‚¬ì§„4', 'ì‚¬ì§„5']];
  ì£¼ì†Œëª©ë¡.forEach(addr => {
    const status = statusMap[addr] || 'ë¯¸ì„ íƒ';
    const memo = memoMap[addr] || '';
    const photos = Array.isArray(photoMap[addr]) ? photoMap[addr] : [];
    const limitedMemo = memo.length > 10000 ? memo.slice(0, 10000) + '...' : memo;
    const row = [addr, status, limitedMemo, ...photos.slice(0, 5)];
    while (row.length < 8) row.push('');
    data.push(row);
  });
  const ws = XLSX.utils.aoa_to_sheet(data);
  
  // ì‚¬ì§„ ë§í¬ ì…€ì— í•˜ì´í¼ë§í¬ ì¶”ê°€
  data.forEach((row, rowIndex) => {
    if (rowIndex === 0) return;
    for (let i = 3; i <= 7; i++) {
      const cellAddr = XLSX.utils.encode_cell({ r: rowIndex, c: i });
      const val = row[i];
      if (val && typeof val === 'string') {
        ws[cellAddr].l = { Target: val };
      }
    }
  });
  
  XLSX.utils.book_append_sheet(wb, ws, 'ì¶œì¥ê¸°ë¡');
  XLSX.writeFile(wb, 'ì¶œì¥ê¸°ë¡.xlsx');
}

  
  // Utility Functions
function saveMapPreference() {
  preferredMap = document.getElementById('mapSelect').value;
  if (document.getElementById('rememberMap') && document.getElementById('rememberMap').checked) {
    localStorage.setItem('preferredMap', preferredMap);
  }
}

function saveAddressList() {
  localStorage.setItem('addressList', JSON.stringify(ì£¼ì†Œëª©ë¡));
}

function saveViewedAddresses() {
  localStorage.setItem('viewedAddresses', JSON.stringify([...viewedAddresses]));
}

function resetAddressList() {
  if (!confirm('ëª¨ë“  ì£¼ì†Œ ëª©ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  
  ì£¼ì†Œëª©ë¡ = [];
  AppState.currentAddress = null;
  saveAddressList();
  updateAddressPreview();
  updateTravelMode();
  alert('ì£¼ì†Œ ëª©ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

function resetStatusMap() {
  if (!confirm('ëª¨ë“  ìƒíƒœ ì •ë³´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  
  statusMap = {};
  localStorage.removeItem('statusMap');
  alert('ìƒíƒœ ì •ë³´ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

// File handling functions
function loadAddressFile(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    const lines = e.target.result.split(/\r?\n/).filter(line => line.trim());
    const newList = [];
    let added = 0;
    
    lines.forEach(line => {
      const [addr, status] = line.split('\t');
      const trimmedAddr = addr?.trim();
      if (trimmedAddr && !ì£¼ì†Œëª©ë¡.includes(trimmedAddr)) {
        newList.push(trimmedAddr);
        if (status) statusMap[trimmedAddr] = status.trim();
        added++;
      } else if (trimmedAddr && status) {
        statusMap[trimmedAddr] = status.trim();
      }
    });
    
    ì£¼ì†Œëª©ë¡ = [...ì£¼ì†Œëª©ë¡, ...newList];
    alert(`ì£¼ì†Œ íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ: ${lines.length}ê±´ ì¤‘ ${added}ê±´ ì¶”ê°€ë¨ (ì´ ${ì£¼ì†Œëª©ë¡.length}ê±´)`);
    
    saveAddressList();
    localStorage.setItem('statusMap', JSON.stringify(statusMap));
    nextStep(3);
  };
  
  reader.readAsText(file, 'UTF-8');
}

function addFromTextarea() {
  const input = document.getElementById('bulkPaste').value;
  if (!input) {
    alert('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  const lines = input.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
  const newList = lines.filter(l => !ì£¼ì†Œëª©ë¡.includes(l));
  ì£¼ì†Œëª©ë¡ = [...ì£¼ì†Œëª©ë¡, ...newList];
  saveAddressList();
  
  alert(`${newList.length}ê°œì˜ ì£¼ì†Œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
  document.getElementById('bulkPaste').value = '';
  nextStep(3);
}

// Imgur upload function
function uploadToImgur(base64Image) {
  return fetch('https://api.imgur.com/3/image', {
    method: 'POST',
    headers: {
      Authorization: 'Client-ID a0058fd0a6e3657',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      image: base64Image.split(',')[1],
      type: 'base64'
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success && data.data && data.data.link) {
      return data.data.link;
    } else {
      throw new Error('Imgur ì—…ë¡œë“œ ì‹¤íŒ¨');
    }
  });
}

// Initialize app on page load
// Data Management Functions
let selectedAddressesForReset = new Set();

function updateDataStatus() {
  const totalAddresses = document.getElementById('total-addresses');
  if (totalAddresses) {
    totalAddresses.textContent = ì£¼ì†Œëª©ë¡.length;
  }
}

function showDataOptions() {
  document.getElementById('dataModal').classList.add('show');
}

function showResetOptions() {
  document.getElementById('dataModal').classList.remove('show');
  document.getElementById('resetModal').classList.add('show');
}

function showAddressSelector() {
  if (ì£¼ì†Œëª©ë¡.length === 0) {
    alert('ì‚­ì œí•  ì¶œì¥ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }
  
  document.getElementById('resetModal').classList.remove('show');
  document.getElementById('addressSelectorModal').classList.add('show');
  
  // Populate address list
  const container = document.getElementById('address-selector-list');
  container.innerHTML = '';
  
  ì£¼ì†Œëª©ë¡.forEach((addr, index) => {
    const status = statusMap[addr] || 'ë¯¸ì„ íƒ';
    const hasData = statusMap[addr] || memoMap[addr] || (photoMap[addr] && photoMap[addr].length > 0);
    
    const item = document.createElement('div');
    item.className = 'option-card';
    item.style.cssText = `
      padding: 15px;
      margin-bottom: 10px;
      cursor: pointer;
      border: 2px solid #e1e5e9;
      transition: all 0.3s ease;
      ${selectedAddressesForReset.has(addr) ? 'border-color: #e74c3c; background: rgba(231, 76, 60, 0.1);' : ''}
    `;
    
    item.innerHTML = `
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="font-weight: 600; margin-bottom: 5px;">${addr}</div>
          <div style="font-size: 0.9rem; color: #666;">
            ìƒíƒœ: ${status}
            ${hasData ? ' â€¢ ê¸°ë¡ ìˆìŒ' : ' â€¢ ê¸°ë¡ ì—†ìŒ'}
          </div>
        </div>
        <div style="font-size: 1.2rem;">
          ${selectedAddressesForReset.has(addr) ? 'âœ“' : 'â—‹'}
        </div>
      </div>
    `;
    
    item.onclick = () => toggleAddressSelection(addr, item);
    container.appendChild(item);
  });
}

function toggleAddressSelection(address, element) {
  if (selectedAddressesForReset.has(address)) {
    selectedAddressesForReset.delete(address);
    element.style.borderColor = '#e1e5e9';
    element.style.background = '';
    element.querySelector('div:last-child').textContent = 'â—‹';
  } else {
    selectedAddressesForReset.add(address);
    element.style.borderColor = '#e74c3c';
    element.style.background = 'rgba(231, 76, 60, 0.1)';
    element.querySelector('div:last-child').textContent = 'âœ“';
  }
  
  // Show/hide reset button
  const resetBtn = document.getElementById('reset-selected-btn');
  if (selectedAddressesForReset.size > 0) {
    resetBtn.style.display = 'block';
    resetBtn.textContent = `ğŸ—‘ï¸ ì„ íƒëœ ${selectedAddressesForReset.size}ê°œ í•­ëª© ì‚­ì œ`;
  } else {
    resetBtn.style.display = 'none';
  }
}

function resetSelectedAddresses() {
  if (selectedAddressesForReset.size === 0) return;
  
  const confirmMsg = `ì„ íƒëœ ${selectedAddressesForReset.size}ê°œ ì¶œì¥ì§€ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œë  í•­ëª©:\n${Array.from(selectedAddressesForReset).join('\n')}\n\nì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
  
  if (!confirm(confirmMsg)) return;
  
  // Remove selected addresses from all data structures
  selectedAddressesForReset.forEach(addr => {
    const index = ì£¼ì†Œëª©ë¡.indexOf(addr);
    if (index > -1) {
      ì£¼ì†Œëª©ë¡.splice(index, 1);
    }
    delete statusMap[addr];
    delete memoMap[addr];
    delete photoMap[addr];
    delete originalPhotoMap[addr];
    viewedAddresses.delete(addr);
  });
  
  // Save to localStorage
  saveAddressList();
  localStorage.setItem('statusMap', JSON.stringify(statusMap));
  localStorage.setItem('memoMap', JSON.stringify(memoMap));
  localStorage.setItem('photoMap', JSON.stringify(photoMap));
  saveViewedAddresses();
  
  // Reset selection
  selectedAddressesForReset.clear();
  
  // Update UI
  updateDataStatus();
  updateAddressPreview();
  updateTravelMode();
  
  alert(`ì„ íƒëœ ì¶œì¥ì§€ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
  closeModal();
}

function confirmFullReset() {
  const confirmMsg = 'ëª¨ë“  ì¶œì¥ì§€ì™€ ê¸°ë¡ì„ ì™„ì „íˆ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në‹¤ìŒ ë°ì´í„°ê°€ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤:\n- ëª¨ë“  ì¶œì¥ì§€ ëª©ë¡\n- ëª¨ë“  ì¶œì¥ ìƒíƒœ\n- ëª¨ë“  ë©”ëª¨\n- ëª¨ë“  ì‚¬ì§„\n\nì´ ì‘ì—…ì€ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
  
  if (!confirm(confirmMsg)) return;
  
  // Clear all data
  ì£¼ì†Œëª©ë¡ = [];
  statusMap = {};
  memoMap = {};
  photoMap = {};
  viewedAddresses.clear();
  AppState.currentAddress = null;
  
  // Clear localStorage
  localStorage.removeItem('addressList');
  localStorage.removeItem('statusMap');
  localStorage.removeItem('memoMap');
  localStorage.removeItem('photoMap');
  localStorage.removeItem('viewedAddresses');
  
  // Update UI
  updateDataStatus();
  updateAddressPreview();
  updateTravelMode();
  
  alert('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
  closeModal();
}

function continueWithExistingData() {
  closeModal();
}

function closeModal() {
  document.querySelectorAll('.modal').forEach(modal => {
    modal.classList.remove('show');
  });
  selectedAddressesForReset.clear();
}

document.addEventListener('DOMContentLoaded', function() {
  // Set initial map preference
  document.getElementById('mapSelect').value = preferredMap;
  
  // Update data status
  updateDataStatus();
  
  // Initialize first mode
  selectMode('prepare');
  
  // Update previews if data exists
  if (ì£¼ì†Œëª©ë¡.length > 0) {
    updateAddressPreview();
  }
  
  // Initialize map selection UI
  updateMapSelection();
});


// Legacy compatibility functions (empty implementations)
function showTab() {} // No longer used
function saveMemo() {} // Replaced by saveRecord
function showDropdown() {} // No longer used
function handleStatusChange() {} // Replaced by handleRecordStatusChange
function saveStatus() {} // Replaced by saveRecord
function openMapInNewTab() {} // Replaced by openMapForAddress
function updateTable() {} // Moved to updateSummaryMode
function drawChart() {} // Moved to updateSummaryMode


</script>
</body>
</html>

